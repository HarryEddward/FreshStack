name: Pull All Docker Images to VPS

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  deploy:
    if: true
    runs-on: ubuntu-latest
    steps:
      - name: Pull Docker Images on VPS
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_KEY }}
          port: ${{ secrets.VPS_PORT || 22 }}
          script: |
            set -e

            echo "üîπ Actualizando lista de im√°genes Docker"

            # Forzar login si usas un registry privado (opcional)
            # docker login -u ${{ secrets.DOCKER_USER }} -p ${{ secrets.DOCKER_PASS }}

            # Lista de im√°genes a actualizar
            IMAGES=(
              "traefik:v3.1"
              "traefik/whoami:latest"
              "jenkins/jenkins:lts"
              "jenkins/inbound-agent:latest"
              "bitnami/redis:latest"
              "bitnami/redis-sentinel:latest"
              "chrislusf/seaweedfs"
              "denoland/deno:alpine-1.41.2"
              "node:18-alpine"
              "quay.io/keycloak/keycloak:latest"
              "bitnami/pgbouncer:latest"
              "bitnami/postgresql-repmgr:16"
            )

            for IMAGE in "${IMAGES[@]}"; do
              echo "‚¨áÔ∏è  Pulling $IMAGE..."
              sudo docker pull "$IMAGE"
            done

            echo "‚úÖ Todas las im√°genes Docker fueron actualizadas correctamente"
