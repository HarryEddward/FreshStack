global
    daemon
    log stdout local0
    maxconn 4096

defaults
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    log global

# Frontend para conexiones de base de datos
frontend postgres_frontend
    bind *:5433
    default_backend pgbouncer_backend

# Backend con múltiples instancias de PgBouncer
backend pgbouncer_backend
    balance roundrobin
    option tcp-check
    tcp-check connect
    tcp-check send-binary 00000016  # Tamaño del mensaje
    tcp-check send-binary 00030000  # Protocolo SSL
    tcp-check expect binary 4e       # Respuesta 'N' (SSL no soportado)
    
    server pgbouncer1 pgbouncer:5432 check inter 5000ms fall 3 rise 2
    server pgbouncer2 pgbouncer:5432 check inter 5000ms fall 3 rise 2

# Panel de estadísticas (opcional)
frontend stats
    bind *:8186
    stats enable
    stats uri /stats
    stats refresh 30s
    stats admin if TRUE